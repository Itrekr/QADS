#!/bin/bash

directory="/home/user/Notes/Journal/"
current_date=$(date +%s) # Current date in seconds since the epoch
days_ago_30=$(date -d '30 days ago' +%s) # 30 days ago in seconds since the epoch

# Use a regular expression to match files that are named with a date format
regex='^[0-9]{4}-[0-9]{2}-[0-9]{2}\.org$'

# Initialize an array to hold files that match our criteria
matching_files=()

# Populate the array with matching files
while IFS= read -r -d $'\0' file; do
    filename=$(basename -- "$file")
    
    # Check if the file name matches the date format
    if [[ $filename =~ $regex ]]; then
        # Extract the date from the filename
        date_in_filename="${filename%.*}"
        
        # Convert the date from the filename to seconds since the epoch for comparison
        date_in_seconds=$(date -d "$date_in_filename" +%s 2>/dev/null)
        
        if [ $? -eq 0 ]; then
            # Check if the date in the filename is within the last 30 days
            if [ "$date_in_seconds" -ge "$days_ago_30" ] && [ "$date_in_seconds" -le "$current_date" ]; then
                matching_files+=("$date_in_filename $file")
            fi
        fi
    fi
done < <(find "$directory" -type f -print0)

# Sort the array of matching files by date
IFS=$'\n' sorted_files=($(sort <<<"${matching_files[*]}"))
unset IFS

# Display the contents of each sorted matching file
for entry in "${sorted_files[@]}"; do
    # Extract the full file path from the entry (all after the first space)
    file="${entry#* }"
    date_in_filename=$(basename -- "$file")
    date_in_filename="${date_in_filename%.*}"
    
    echo "$date_in_filename"
    tail -n +5 "$file"
    echo
    echo
    echo "--------------------------------"
    echo
done
